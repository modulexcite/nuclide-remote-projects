
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var NUCLIDE_PROTOCOL_PREFIX = 'nuclide:/';
var NUCLIDE_PROTOCOL_PREFIX_LENGTH = NUCLIDE_PROTOCOL_PREFIX.length;

/**
 * Clean a nuclide URI from the prepended absolute path prefixes and fix
 * the broken uri, in the sense that it's nuclide:/server:897/path/to/dir instead of
 * nuclide://server:897/path/to/dir because Atom called path.normalize() on the directory uri.
 */
function sanitizeNuclideUri(uri) {
  // Remove the leading absolute path prepended to the file paths
  // between atom reloads.
  var protocolIndex = uri.indexOf(NUCLIDE_PROTOCOL_PREFIX);
  if (protocolIndex > 0) {
    uri = uri.substring(protocolIndex);
  }
  // Add the missing slash, if removed through a path.normalize() call.
  if (uri.startsWith(NUCLIDE_PROTOCOL_PREFIX) && uri[NUCLIDE_PROTOCOL_PREFIX_LENGTH] !== '/' /*protocol missing last slash*/) {

      uri = uri.substring(0, NUCLIDE_PROTOCOL_PREFIX_LENGTH) + '/' + uri.substring(NUCLIDE_PROTOCOL_PREFIX_LENGTH);
    }
  return uri;
}

module.exports = {
  sanitizeNuclideUri: sanitizeNuclideUri
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL2FwbS9udWNsaWRlLXJlbW90ZS1wcm9qZWN0cy9saWIvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsV0FBVyxDQUFDOzs7Ozs7Ozs7O0FBV1osSUFBTSx1QkFBdUIsR0FBRyxXQUFXLENBQUM7QUFDNUMsSUFBTSw4QkFBOEIsR0FBRyx1QkFBdUIsQ0FBQyxNQUFNLENBQUM7Ozs7Ozs7QUFPdEUsU0FBUyxrQkFBa0IsQ0FBQyxHQUFXLEVBQVU7OztBQUcvQyxNQUFJLGFBQWEsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDekQsTUFBSSxhQUFhLEdBQUcsQ0FBQyxFQUFFO0FBQ3JCLE9BQUcsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0dBQ3BDOztBQUVELE1BQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxJQUN2QyxHQUFHLENBQUMsOEJBQThCLENBQUMsS0FBSyxHQUFHLGtDQUFrQzs7QUFFL0UsU0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLDhCQUE4QixDQUFDLEdBQ2xELEdBQUcsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLDhCQUE4QixDQUFDLENBQUM7S0FDekQ7QUFDRCxTQUFPLEdBQUcsQ0FBQztDQUNaOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUc7QUFDZixvQkFBa0IsRUFBbEIsa0JBQWtCO0NBQ25CLENBQUMiLCJmaWxlIjoiL3Zhci9mb2xkZXJzL3hmL3JzcGg0X2M1NzMxNXJzNTd4eHNkc2tyeG52MzZ0MC9UL3RtcGVtbTJIdXB1Ymxpc2hfcGFja2FnZXMvYXBtL251Y2xpZGUtcmVtb3RlLXByb2plY3RzL2xpYi91dGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyogQGZsb3cgKi9cblxuLypcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBsaWNlbnNlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW5cbiAqIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmNvbnN0IE5VQ0xJREVfUFJPVE9DT0xfUFJFRklYID0gJ251Y2xpZGU6Lyc7XG5jb25zdCBOVUNMSURFX1BST1RPQ09MX1BSRUZJWF9MRU5HVEggPSBOVUNMSURFX1BST1RPQ09MX1BSRUZJWC5sZW5ndGg7XG5cbi8qKlxuICogQ2xlYW4gYSBudWNsaWRlIFVSSSBmcm9tIHRoZSBwcmVwZW5kZWQgYWJzb2x1dGUgcGF0aCBwcmVmaXhlcyBhbmQgZml4XG4gKiB0aGUgYnJva2VuIHVyaSwgaW4gdGhlIHNlbnNlIHRoYXQgaXQncyBudWNsaWRlOi9zZXJ2ZXI6ODk3L3BhdGgvdG8vZGlyIGluc3RlYWQgb2ZcbiAqIG51Y2xpZGU6Ly9zZXJ2ZXI6ODk3L3BhdGgvdG8vZGlyIGJlY2F1c2UgQXRvbSBjYWxsZWQgcGF0aC5ub3JtYWxpemUoKSBvbiB0aGUgZGlyZWN0b3J5IHVyaS5cbiAqL1xuZnVuY3Rpb24gc2FuaXRpemVOdWNsaWRlVXJpKHVyaTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gUmVtb3ZlIHRoZSBsZWFkaW5nIGFic29sdXRlIHBhdGggcHJlcGVuZGVkIHRvIHRoZSBmaWxlIHBhdGhzXG4gIC8vIGJldHdlZW4gYXRvbSByZWxvYWRzLlxuICB2YXIgcHJvdG9jb2xJbmRleCA9IHVyaS5pbmRleE9mKE5VQ0xJREVfUFJPVE9DT0xfUFJFRklYKTtcbiAgaWYgKHByb3RvY29sSW5kZXggPiAwKSB7XG4gICAgdXJpID0gdXJpLnN1YnN0cmluZyhwcm90b2NvbEluZGV4KTtcbiAgfVxuICAvLyBBZGQgdGhlIG1pc3Npbmcgc2xhc2gsIGlmIHJlbW92ZWQgdGhyb3VnaCBhIHBhdGgubm9ybWFsaXplKCkgY2FsbC5cbiAgaWYgKHVyaS5zdGFydHNXaXRoKE5VQ0xJREVfUFJPVE9DT0xfUFJFRklYKSAmJlxuICAgICAgdXJpW05VQ0xJREVfUFJPVE9DT0xfUFJFRklYX0xFTkdUSF0gIT09ICcvJyAvKnByb3RvY29sIG1pc3NpbmcgbGFzdCBzbGFzaCovKSB7XG5cbiAgICB1cmkgPSB1cmkuc3Vic3RyaW5nKDAsIE5VQ0xJREVfUFJPVE9DT0xfUFJFRklYX0xFTkdUSCkgK1xuICAgICAgICAnLycgKyB1cmkuc3Vic3RyaW5nKE5VQ0xJREVfUFJPVE9DT0xfUFJFRklYX0xFTkdUSCk7XG4gIH1cbiAgcmV0dXJuIHVyaTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHNhbml0aXplTnVjbGlkZVVyaSxcbn07XG4iXX0=
