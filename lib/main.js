
/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

var createRemoteConnection = _asyncToGenerator(function* (remoteProjectConfig) {
  var RemoteConnection = getRemoteConnection();

  try {
    var connection = new RemoteConnection(restoreClientKey(remoteProjectConfig));
    yield connection.initialize();
    return connection;
  } catch (e) {
    // If connection fails using saved config, open connect dialog.

    var _require2 = require('nuclide-ssh-dialog');

    var openConnectionDialog = _require2.openConnectionDialog;

    return openConnectionDialog({
      initialServer: remoteProjectConfig.host,
      initialCwd: remoteProjectConfig.cwd
    });
  }
});

/**
 * Restore a nuclide project state from a serialized state of the remote connection config.
 */

var restoreNuclideProjectState = _asyncToGenerator(function* (remoteProjectConfig) {
  // TODO use the rest of the config for the connection dialog.
  var projectHostname = remoteProjectConfig.host;
  var projectDirectory = remoteProjectConfig.cwd;

  // try to re-connect, then, add the project to atom.project and the tree.
  var connection = yield createRemoteConnection(remoteProjectConfig);
  if (!connection) {
    getLogger().info('No RemoteConnection returned on restore state trial:', projectHostname, projectDirectory);
  }
  // Reload the project files that have empty text editors/buffers open.
  var closedUris = closeOpenFilesForRemoteProject(remoteProjectConfig);
  // On Atom restart, it tries to open the uri path as a file tab because it's not a local directory.
  // Hence, we close it in the cleanup, because we have the needed connection config saved
  // with the last opened files in the package state.
  if (connection) {
    closedUris.forEach(function (uri) {
      return atom.workspace.open(uri);
    });
  }
});

/**
 * The same TextEditor must be returned to prevent Atom from creating multiple tabs
 * for the same file, because Atom doesn't cache pending opener promises.
 */

var createEditorForNuclide = _asyncToGenerator(function* (connection, uri) {
  var NuclideTextBuffer = require('./NuclideTextBuffer');

  var buffer = new NuclideTextBuffer(connection, { filePath: uri });
  buffer.setEncoding(atom.config.get('core.fileEncoding'));
  try {
    yield buffer.load();
  } catch (err) {
    getLogger().warn('buffer load issue:', err);
    throw err;
  }
  return new TextEditor( /*editorOptions*/{ buffer: buffer, registerEditor: true });
}

/**
 * Encrypts the clientKey of a RemoteConnectionConfiguration.
 * @param remoteProjectConfig - The config with the clientKey we want encrypted.
 * @return returns the passed in config with the clientKey encrypted.
 */
);

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

var _require = require('atom');

var CompositeDisposable = _require.CompositeDisposable;
var TextEditor = _require.TextEditor;

var subscriptions = null;
var pendingFiles = {};

var logger = null;
function getLogger() {
  return logger || (logger = require('nuclide-logging').getLogger());
}

var RemoteConnection = null;
function getRemoteConnection() {
  return RemoteConnection || (RemoteConnection = require('nuclide-remote-connection').RemoteConnection);
}

function addRemoteFolderToProject(connection) {
  var workingDirectoryUri = connection.getUriForInitialWorkingDirectory();
  // If restoring state, then the project already exists with local directory and wrong repo instances.
  // Hence, we remove it here, if existing, and add the new path for which we added a workspace opener handler.
  atom.project.removePath(workingDirectoryUri);

  atom.project.addPath(workingDirectoryUri);

  var subscription = atom.project.onDidChangePaths(function (paths) {
    if (paths.indexOf(workingDirectoryUri) !== -1) {
      return;
    }
    // The project was removed from the tree.
    subscription.dispose();

    closeOpenFilesForRemoteProject(connection.getConfig());

    var hostname = connection.getRemoteHostname();
    if (getRemoteConnection().getByHostname(hostname).length > 1) {
      getLogger().info('Remaining remote projects using Nuclide Server - no prompt to shutdown');
      return connection.close();
    }

    var choice = atom.confirm({
      message: 'No more remote projects on the host: \'' + hostname + '\'. Would you like to shutdown Nuclide server there?',
      buttons: ['Shutdown', 'Keep It']
    });
    if (choice === 1) {
      return connection.close();
    }
    if (choice === 0) {
      connection.getClient().shutdownServer();
      return connection.close();
    }
  });
}

function closeOpenFilesForRemoteProject(remoteProjectConfig) {
  var _require3 = require('nuclide-atom-helpers');

  var closeTabForBuffer = _require3.closeTabForBuffer;

  var _require4 = require('./utils');

  var sanitizeNuclideUri = _require4.sanitizeNuclideUri;
  var projectHostname = remoteProjectConfig.host;
  var projectDirectory = remoteProjectConfig.cwd;

  var closedUris = [];
  atom.workspace.getTextEditors().forEach(function (editor) {
    var rawUrl = editor.getURI();
    if (!rawUrl) {
      return;
    }
    var uri = sanitizeNuclideUri(rawUrl);

    var _require$parse = require('nuclide-remote-uri').parse(uri);

    var fileHostname = _require$parse.hostname;
    var filePath = _require$parse.path;

    if (fileHostname === projectHostname && filePath.startsWith(projectDirectory)) {
      closeTabForBuffer(editor.getBuffer());
      if (filePath !== projectDirectory) {
        closedUris.push(uri);
      }
    }
  });
  return closedUris;
}

function cleanupRemoteNuclideProjects() {
  getRemoteRootDirectories().forEach(function (directory) {
    return atom.project.removePath(directory.getPath());
  });
}

function getRemoteRootDirectories() {
  return atom.project.getDirectories().filter(function (directory) {
    return directory.getPath().startsWith('nuclide:');
  });
}function protectClientKey(remoteProjectConfig) {
  var _require5 = require('nuclide-keytar-wrapper');

  var replacePassword = _require5.replacePassword;

  var crypto = require('crypto');

  var sha1 = crypto.createHash('sha1');
  sha1.update(remoteProjectConfig.host + ':' + remoteProjectConfig.port);
  var sha1sum = sha1.digest('hex');

  var _encryptString = encryptString(remoteProjectConfig.clientKey);

  var salt = _encryptString.salt;
  var password = _encryptString.password;
  var encryptedString = _encryptString.encryptedString;

  replacePassword('nuclide.remoteProjectConfig', sha1sum, '' + password);

  remoteProjectConfig.clientKey = encryptedString + '.' + salt;

  return remoteProjectConfig;
}

/**
 * Decrypts the clientKey of a RemoteConnectionConfiguration.
 * @param remoteProjectConfig - The config with the clientKey we want encrypted.
 * @return returns the passed in config with the clientKey encrypted.
 */
function restoreClientKey(remoteProjectConfig) {
  var _require6 = require('nuclide-keytar-wrapper');

  var getPassword = _require6.getPassword;

  var crypto = require('crypto');

  var sha1 = crypto.createHash('sha1');
  sha1.update(remoteProjectConfig.host + ':' + remoteProjectConfig.port);
  var sha1sum = sha1.digest('hex');

  var password = getPassword('nuclide.remoteProjectConfig', sha1sum);

  if (!password) {
    throw new Error('Cannot find password for encrypted client key');
  }

  var salt;
  var clientKey;

  var _remoteProjectConfig$clientKey$split = remoteProjectConfig.clientKey.split('.');

  var _remoteProjectConfig$clientKey$split2 = _slicedToArray(_remoteProjectConfig$clientKey$split, 2);

  clientKey = _remoteProjectConfig$clientKey$split2[0];
  salt = _remoteProjectConfig$clientKey$split2[1];

  if (!clientKey || !salt) {
    throw new Error('Cannot decrypt client key');
  }

  remoteProjectConfig.clientKey = decryptString(clientKey, password, salt);

  return remoteProjectConfig;
}

function decryptString(text, password, salt) {
  var crypto = require('crypto');

  var decipher = crypto.createDecipheriv('aes-128-cbc', new Buffer(password, 'base64'), new Buffer(salt, 'base64'));

  var decryptedString = decipher.update(text, 'base64', 'utf8');
  decryptedString += decipher.final('utf8');

  return decryptedString;
}

function encryptString(text) {
  var crypto = require('crypto');
  var password = crypto.randomBytes(16).toString('base64');
  var salt = crypto.randomBytes(16).toString('base64');

  var cipher = crypto.createCipheriv('aes-128-cbc', new Buffer(password, 'base64'), new Buffer(salt, 'base64'));

  var encryptedString = cipher.update(text, 'utf8', 'base64');
  encryptedString += cipher.final('base64');

  return {
    password: password,
    salt: salt,
    encryptedString: encryptedString
  };
}

module.exports = {
  __test__: {
    decryptString: decryptString,
    encryptString: encryptString
  },

  activate: function activate(state) {
    subscriptions = new CompositeDisposable();

    subscriptions.add(getRemoteConnection().onDidAddRemoteConnection(function (connection) {
      addRemoteFolderToProject(connection);
    }));

    // Don't do require or any other expensive operations in activate().
    subscriptions.add(atom.packages.onDidActivateInitialPackages(function () {
      // Subscribe opener before restoring the remote projects.
      subscriptions.add(atom.workspace.addOpener(function () {
        var uri = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];

        if (uri.startsWith('nuclide:')) {
          var connection = getRemoteConnection().getForUri(uri);
          // On Atom restart, it tries to open the uri path as a file tab because it's not a local directory.
          // We can't let that create a file with the initial working directory path.
          if (connection && uri !== connection.getUriForInitialWorkingDirectory()) {
            if (pendingFiles[uri]) {
              return pendingFiles[uri];
            }
            var textEditorPromise = pendingFiles[uri] = createEditorForNuclide(connection, uri);
            var removeFromCache = function removeFromCache() {
              return delete pendingFiles[uri];
            };
            textEditorPromise.then(removeFromCache, removeFromCache);
            return textEditorPromise;
          }
        }
      }));
      subscriptions.add(atom.commands.add('atom-workspace', 'nuclide-remote-projects:connect', function () {
        return require('nuclide-ssh-dialog').openConnectionDialog();
      }));

      // Remove remote projects added in case of reloads.
      // We already have their connection config stored.
      var remoteProjectsConfig = state && state.remoteProjectsConfig || [];
      remoteProjectsConfig.forEach(restoreNuclideProjectState);
      // Clear obsolete config.
      atom.config.set('nuclide.remoteProjectsConfig', []);
    }));
  },

  serialize: function serialize() {
    var remoteProjectsConfig = getRemoteRootDirectories().map(function (directory) {
      var connection = getRemoteConnection().getForUri(directory.getPath());
      return connection && protectClientKey(connection.getConfig());
    }).filter(function (config) {
      return !!config;
    });
    return {
      remoteProjectsConfig: remoteProjectsConfig
    };
  },

  deactivate: function deactivate() {
    // This should always be true here, but we do this to appease Flow.
    if (subscriptions) {
      subscriptions.dispose();
      subscriptions = null;
    }
  },

  createRemoteDirectoryProvider: function createRemoteDirectoryProvider() {
    var RemoteDirectoryProvider = require('./RemoteDirectoryProvider');
    return new RemoteDirectoryProvider();
  },

  createRemoteDirectorySearcher: function createRemoteDirectorySearcher() {
    var _require7 = require('nuclide-client');

    var getServiceByNuclideUri = _require7.getServiceByNuclideUri;

    var _require8 = require('nuclide-remote-connection');

    var RemoteDirectory = _require8.RemoteDirectory;

    var RemoteDirectorySearcher = require('./RemoteDirectorySearcher');
    return new RemoteDirectorySearcher(function (dir) {
      return getServiceByNuclideUri('FindInProjectService', dir.getPath());
    });
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi92YXIvZm9sZGVycy94Zi9yc3BoNF9jNTczMTVyczU3eHhzZHNrcnhudjM2dDAvVC90bXBlbW0ySHVwdWJsaXNoX3BhY2thZ2VzL2FwbS9udWNsaWRlLXJlbW90ZS1wcm9qZWN0cy9saWIvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7Ozs7Ozs7Ozs7OztJQTBCRyxzQkFBc0IscUJBQXJDLFdBQXNDLG1CQUFrRCxFQUE4QjtBQUNwSCxNQUFJLGdCQUFnQixHQUFHLG1CQUFtQixFQUFFLENBQUM7O0FBRTdDLE1BQUk7QUFDRixRQUFJLFVBQVUsR0FBRyxJQUFJLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztBQUM3RSxVQUFNLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUM5QixXQUFPLFVBQVUsQ0FBQztHQUNuQixDQUFDLE9BQU8sQ0FBQyxFQUFFOzs7b0JBRW1CLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQzs7UUFBckQsb0JBQW9CLGFBQXBCLG9CQUFvQjs7QUFDekIsV0FBTyxvQkFBb0IsQ0FBQztBQUMxQixtQkFBYSxFQUFFLG1CQUFtQixDQUFDLElBQUk7QUFDdkMsZ0JBQVUsRUFBRSxtQkFBbUIsQ0FBQyxHQUFHO0tBQ3BDLENBQUMsQ0FBQztHQUNKO0NBQ0Y7Ozs7OztJQWlFYywwQkFBMEIscUJBQXpDLFdBQTBDLG1CQUFrRCxFQUFFOztNQUVqRixlQUFlLEdBQTJCLG1CQUFtQixDQUFuRSxJQUFJO01BQXdCLGdCQUFnQixHQUFJLG1CQUFtQixDQUE1QyxHQUFHOzs7QUFFL0IsTUFBSSxVQUFVLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQ25FLE1BQUksQ0FBQyxVQUFVLEVBQUU7QUFDZixhQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0RBQXNELEVBQUUsZUFBZSxFQUFFLGdCQUFnQixDQUFDLENBQUM7R0FDN0c7O0FBRUQsTUFBSSxVQUFV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QSxzQkFBUzs7QUFFakIsUUFBSSxhQUFhLEVBQUU7QUFDakIsbUJBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUN4QixtQkFBYSxHQUFHLElBQUksQ0FBQztLQUN0QjtHQUNGOztBQUVELCtCQUE2QixFQUFBLHlDQUE0QjtBQUN2RCxRQUFJLHVCQUF1QixHQUFHLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQ25FLFdBQU8sSUFBSSx1QkFBdUIsRUFBRSxDQUFDO0dBQ3RDOztBQUVELCtCQUE2QixFQUFBLHlDQUE0QjtvQkFDeEIsT0FBTyxDQUFDLGdCQUFnQixDQUFDOztRQUFuRCxzQkFBc0IsYUFBdEIsc0JBQXNCOztvQkFDSCxPQUFPLENBQUMsMkJBQTJCLENBQUM7O1FBQXZELGVBQWUsYUFBZixlQUFlOztBQUNwQixRQUFJLHVCQUF1QixHQUFHLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQ25FLFdBQU8sSUFBSSx1QkFBdUIsQ0FBQyxVQUFDLEdBQUc7YUFDckMsc0JBQXNCLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQUEsQ0FBQyxDQUFDO0dBQ2xFO0NBQ0YsQ0FBQyIsImZpbGUiOiIvdmFyL2ZvbGRlcnMveGYvcnNwaDRfYzU3MzE1cnM1N3h4c2Rza3J4bnYzNnQwL1QvdG1wZW1tMkh1cHVibGlzaF9wYWNrYWdlcy9hcG0vbnVjbGlkZS1yZW1vdGUtcHJvamVjdHMvbGliL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcbi8qIEBmbG93ICovXG5cbi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgbGljZW5zZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluXG4gKiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG52YXIge0NvbXBvc2l0ZURpc3Bvc2FibGUsIFRleHRFZGl0b3J9ID0gcmVxdWlyZSgnYXRvbScpO1xuXG52YXIgc3Vic2NyaXB0aW9uczogP0NvbXBvc2l0ZURpc3Bvc2FibGUgPSBudWxsO1xudmFyIHBlbmRpbmdGaWxlcyA9IHt9O1xuXG52YXIgbG9nZ2VyID0gbnVsbDtcbmZ1bmN0aW9uIGdldExvZ2dlcigpIHtcbiAgcmV0dXJuIGxvZ2dlciB8fCAobG9nZ2VyID0gcmVxdWlyZSgnbnVjbGlkZS1sb2dnaW5nJykuZ2V0TG9nZ2VyKCkpO1xufVxuXG52YXIgUmVtb3RlQ29ubmVjdGlvbiA9IG51bGw7XG5mdW5jdGlvbiBnZXRSZW1vdGVDb25uZWN0aW9uKCk6IFJlbW90ZUNvbm5lY3Rpb24ge1xuICByZXR1cm4gUmVtb3RlQ29ubmVjdGlvbiB8fCAoUmVtb3RlQ29ubmVjdGlvbiA9IHJlcXVpcmUoJ251Y2xpZGUtcmVtb3RlLWNvbm5lY3Rpb24nKS5SZW1vdGVDb25uZWN0aW9uKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlUmVtb3RlQ29ubmVjdGlvbihyZW1vdGVQcm9qZWN0Q29uZmlnOiBSZW1vdGVDb25uZWN0aW9uQ29uZmlndXJhdGlvbik6IFByb21pc2U8P1JlbW90ZUNvbm5lY3Rpb24+IHtcbiAgdmFyIFJlbW90ZUNvbm5lY3Rpb24gPSBnZXRSZW1vdGVDb25uZWN0aW9uKCk7XG5cbiAgdHJ5IHtcbiAgICB2YXIgY29ubmVjdGlvbiA9IG5ldyBSZW1vdGVDb25uZWN0aW9uKHJlc3RvcmVDbGllbnRLZXkocmVtb3RlUHJvamVjdENvbmZpZykpO1xuICAgIGF3YWl0IGNvbm5lY3Rpb24uaW5pdGlhbGl6ZSgpO1xuICAgIHJldHVybiBjb25uZWN0aW9uO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gSWYgY29ubmVjdGlvbiBmYWlscyB1c2luZyBzYXZlZCBjb25maWcsIG9wZW4gY29ubmVjdCBkaWFsb2cuXG4gICAgdmFyIHtvcGVuQ29ubmVjdGlvbkRpYWxvZ30gPSByZXF1aXJlKCdudWNsaWRlLXNzaC1kaWFsb2cnKTtcbiAgICByZXR1cm4gb3BlbkNvbm5lY3Rpb25EaWFsb2coe1xuICAgICAgaW5pdGlhbFNlcnZlcjogcmVtb3RlUHJvamVjdENvbmZpZy5ob3N0LFxuICAgICAgaW5pdGlhbEN3ZDogcmVtb3RlUHJvamVjdENvbmZpZy5jd2QsXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWRkUmVtb3RlRm9sZGVyVG9Qcm9qZWN0KGNvbm5lY3Rpb246IFJlbW90ZUNvbm5lY3Rpb24pIHtcbiAgdmFyIHdvcmtpbmdEaXJlY3RvcnlVcmkgPSBjb25uZWN0aW9uLmdldFVyaUZvckluaXRpYWxXb3JraW5nRGlyZWN0b3J5KCk7XG4gIC8vIElmIHJlc3RvcmluZyBzdGF0ZSwgdGhlbiB0aGUgcHJvamVjdCBhbHJlYWR5IGV4aXN0cyB3aXRoIGxvY2FsIGRpcmVjdG9yeSBhbmQgd3JvbmcgcmVwbyBpbnN0YW5jZXMuXG4gIC8vIEhlbmNlLCB3ZSByZW1vdmUgaXQgaGVyZSwgaWYgZXhpc3RpbmcsIGFuZCBhZGQgdGhlIG5ldyBwYXRoIGZvciB3aGljaCB3ZSBhZGRlZCBhIHdvcmtzcGFjZSBvcGVuZXIgaGFuZGxlci5cbiAgYXRvbS5wcm9qZWN0LnJlbW92ZVBhdGgod29ya2luZ0RpcmVjdG9yeVVyaSk7XG5cbiAgYXRvbS5wcm9qZWN0LmFkZFBhdGgod29ya2luZ0RpcmVjdG9yeVVyaSk7XG5cbiAgdmFyIHN1YnNjcmlwdGlvbiA9IGF0b20ucHJvamVjdC5vbkRpZENoYW5nZVBhdGhzKHBhdGhzID0+IHtcbiAgICBpZiAocGF0aHMuaW5kZXhPZih3b3JraW5nRGlyZWN0b3J5VXJpKSAhPT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gVGhlIHByb2plY3Qgd2FzIHJlbW92ZWQgZnJvbSB0aGUgdHJlZS5cbiAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xuXG4gICAgY2xvc2VPcGVuRmlsZXNGb3JSZW1vdGVQcm9qZWN0KGNvbm5lY3Rpb24uZ2V0Q29uZmlnKCkpO1xuXG4gICAgdmFyIGhvc3RuYW1lID0gY29ubmVjdGlvbi5nZXRSZW1vdGVIb3N0bmFtZSgpO1xuICAgIGlmIChnZXRSZW1vdGVDb25uZWN0aW9uKCkuZ2V0QnlIb3N0bmFtZShob3N0bmFtZSkubGVuZ3RoID4gMSkge1xuICAgICAgZ2V0TG9nZ2VyKCkuaW5mbygnUmVtYWluaW5nIHJlbW90ZSBwcm9qZWN0cyB1c2luZyBOdWNsaWRlIFNlcnZlciAtIG5vIHByb21wdCB0byBzaHV0ZG93bicpO1xuICAgICAgcmV0dXJuIGNvbm5lY3Rpb24uY2xvc2UoKTtcbiAgICB9XG5cbiAgICB2YXIgY2hvaWNlID0gYXRvbS5jb25maXJtKHtcbiAgICAgIG1lc3NhZ2U6ICdObyBtb3JlIHJlbW90ZSBwcm9qZWN0cyBvbiB0aGUgaG9zdDogXFwnJyArIGhvc3RuYW1lICsgJ1xcJy4gV291bGQgeW91IGxpa2UgdG8gc2h1dGRvd24gTnVjbGlkZSBzZXJ2ZXIgdGhlcmU/JyxcbiAgICAgIGJ1dHRvbnM6IFsnU2h1dGRvd24nLCAnS2VlcCBJdCddLFxuICAgIH0pO1xuICAgIGlmIChjaG9pY2UgPT09IDEpIHtcbiAgICAgIHJldHVybiBjb25uZWN0aW9uLmNsb3NlKCk7XG4gICAgfVxuICAgIGlmIChjaG9pY2UgPT09IDApIHtcbiAgICAgIGNvbm5lY3Rpb24uZ2V0Q2xpZW50KCkuc2h1dGRvd25TZXJ2ZXIoKTtcbiAgICAgIHJldHVybiBjb25uZWN0aW9uLmNsb3NlKCk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gY2xvc2VPcGVuRmlsZXNGb3JSZW1vdGVQcm9qZWN0KHJlbW90ZVByb2plY3RDb25maWc6IFJlbW90ZUNvbm5lY3Rpb25Db25maWd1cmF0aW9uKTogQXJyYXk8c3RyaW5nPiB7XG4gIHZhciB7Y2xvc2VUYWJGb3JCdWZmZXJ9ID0gcmVxdWlyZSgnbnVjbGlkZS1hdG9tLWhlbHBlcnMnKTtcbiAgdmFyIHtzYW5pdGl6ZU51Y2xpZGVVcml9ID0gcmVxdWlyZSgnLi91dGlscycpO1xuXG4gIHZhciB7aG9zdDogcHJvamVjdEhvc3RuYW1lLCBjd2Q6IHByb2plY3REaXJlY3Rvcnl9ID0gcmVtb3RlUHJvamVjdENvbmZpZztcbiAgdmFyIGNsb3NlZFVyaXMgPSBbXTtcbiAgYXRvbS53b3Jrc3BhY2UuZ2V0VGV4dEVkaXRvcnMoKS5mb3JFYWNoKGVkaXRvciA9PiB7XG4gICAgdmFyIHJhd1VybCA9IGVkaXRvci5nZXRVUkkoKTtcbiAgICBpZiAoIXJhd1VybCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdXJpID0gc2FuaXRpemVOdWNsaWRlVXJpKHJhd1VybCk7XG4gICAgdmFyIHtob3N0bmFtZTogZmlsZUhvc3RuYW1lLCBwYXRoOiBmaWxlUGF0aH0gPSByZXF1aXJlKCdudWNsaWRlLXJlbW90ZS11cmknKS5wYXJzZSh1cmkpO1xuICAgIGlmIChmaWxlSG9zdG5hbWUgPT09IHByb2plY3RIb3N0bmFtZSAmJiBmaWxlUGF0aC5zdGFydHNXaXRoKHByb2plY3REaXJlY3RvcnkpKSB7XG4gICAgICBjbG9zZVRhYkZvckJ1ZmZlcihlZGl0b3IuZ2V0QnVmZmVyKCkpO1xuICAgICAgaWYgKGZpbGVQYXRoICE9PSBwcm9qZWN0RGlyZWN0b3J5KSB7XG4gICAgICAgIGNsb3NlZFVyaXMucHVzaCh1cmkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjbG9zZWRVcmlzO1xufVxuXG4vKipcbiAqIFJlc3RvcmUgYSBudWNsaWRlIHByb2plY3Qgc3RhdGUgZnJvbSBhIHNlcmlhbGl6ZWQgc3RhdGUgb2YgdGhlIHJlbW90ZSBjb25uZWN0aW9uIGNvbmZpZy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVzdG9yZU51Y2xpZGVQcm9qZWN0U3RhdGUocmVtb3RlUHJvamVjdENvbmZpZzogUmVtb3RlQ29ubmVjdGlvbkNvbmZpZ3VyYXRpb24pIHtcbiAgLy8gVE9ETyB1c2UgdGhlIHJlc3Qgb2YgdGhlIGNvbmZpZyBmb3IgdGhlIGNvbm5lY3Rpb24gZGlhbG9nLlxuICB2YXIge2hvc3Q6IHByb2plY3RIb3N0bmFtZSwgY3dkOiBwcm9qZWN0RGlyZWN0b3J5fSA9IHJlbW90ZVByb2plY3RDb25maWc7XG4gIC8vIHRyeSB0byByZS1jb25uZWN0LCB0aGVuLCBhZGQgdGhlIHByb2plY3QgdG8gYXRvbS5wcm9qZWN0IGFuZCB0aGUgdHJlZS5cbiAgdmFyIGNvbm5lY3Rpb24gPSBhd2FpdCBjcmVhdGVSZW1vdGVDb25uZWN0aW9uKHJlbW90ZVByb2plY3RDb25maWcpO1xuICBpZiAoIWNvbm5lY3Rpb24pIHtcbiAgICBnZXRMb2dnZXIoKS5pbmZvKCdObyBSZW1vdGVDb25uZWN0aW9uIHJldHVybmVkIG9uIHJlc3RvcmUgc3RhdGUgdHJpYWw6JywgcHJvamVjdEhvc3RuYW1lLCBwcm9qZWN0RGlyZWN0b3J5KTtcbiAgfVxuICAvLyBSZWxvYWQgdGhlIHByb2plY3QgZmlsZXMgdGhhdCBoYXZlIGVtcHR5IHRleHQgZWRpdG9ycy9idWZmZXJzIG9wZW4uXG4gIHZhciBjbG9zZWRVcmlzID0gY2xvc2VPcGVuRmlsZXNGb3JSZW1vdGVQcm9qZWN0KHJlbW90ZVByb2plY3RDb25maWcpO1xuICAvLyBPbiBBdG9tIHJlc3RhcnQsIGl0IHRyaWVzIHRvIG9wZW4gdGhlIHVyaSBwYXRoIGFzIGEgZmlsZSB0YWIgYmVjYXVzZSBpdCdzIG5vdCBhIGxvY2FsIGRpcmVjdG9yeS5cbiAgLy8gSGVuY2UsIHdlIGNsb3NlIGl0IGluIHRoZSBjbGVhbnVwLCBiZWNhdXNlIHdlIGhhdmUgdGhlIG5lZWRlZCBjb25uZWN0aW9uIGNvbmZpZyBzYXZlZFxuICAvLyB3aXRoIHRoZSBsYXN0IG9wZW5lZCBmaWxlcyBpbiB0aGUgcGFja2FnZSBzdGF0ZS5cbiAgaWYgKGNvbm5lY3Rpb24pIHtcbiAgICBjbG9zZWRVcmlzLmZvckVhY2godXJpID0+IGF0b20ud29ya3NwYWNlLm9wZW4odXJpKSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYW51cFJlbW90ZU51Y2xpZGVQcm9qZWN0cygpIHtcbiAgZ2V0UmVtb3RlUm9vdERpcmVjdG9yaWVzKCkuZm9yRWFjaChkaXJlY3RvcnkgPT4gYXRvbS5wcm9qZWN0LnJlbW92ZVBhdGgoZGlyZWN0b3J5LmdldFBhdGgoKSkpO1xufVxuXG5mdW5jdGlvbiBnZXRSZW1vdGVSb290RGlyZWN0b3JpZXMoKSB7XG4gIHJldHVybiBhdG9tLnByb2plY3QuZ2V0RGlyZWN0b3JpZXMoKS5maWx0ZXIoZGlyZWN0b3J5ID0+IGRpcmVjdG9yeS5nZXRQYXRoKCkuc3RhcnRzV2l0aCgnbnVjbGlkZTonKSk7XG59XG5cbi8qKlxuICogVGhlIHNhbWUgVGV4dEVkaXRvciBtdXN0IGJlIHJldHVybmVkIHRvIHByZXZlbnQgQXRvbSBmcm9tIGNyZWF0aW5nIG11bHRpcGxlIHRhYnNcbiAqIGZvciB0aGUgc2FtZSBmaWxlLCBiZWNhdXNlIEF0b20gZG9lc24ndCBjYWNoZSBwZW5kaW5nIG9wZW5lciBwcm9taXNlcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRWRpdG9yRm9yTnVjbGlkZShjb25uZWN0aW9uOiBSZW1vdGVDb25uZWN0aW9uLCB1cmk6IHN0cmluZyk6IFRleHRFZGl0b3Ige1xuICB2YXIgTnVjbGlkZVRleHRCdWZmZXIgPSByZXF1aXJlKCcuL051Y2xpZGVUZXh0QnVmZmVyJyk7XG5cbiAgdmFyIGJ1ZmZlciA9IG5ldyBOdWNsaWRlVGV4dEJ1ZmZlcihjb25uZWN0aW9uLCB7ZmlsZVBhdGg6IHVyaX0pO1xuICBidWZmZXIuc2V0RW5jb2RpbmcoYXRvbS5jb25maWcuZ2V0KCdjb3JlLmZpbGVFbmNvZGluZycpKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBidWZmZXIubG9hZCgpO1xuICB9IGNhdGNoKGVycikge1xuICAgIGdldExvZ2dlcigpLndhcm4oJ2J1ZmZlciBsb2FkIGlzc3VlOicsIGVycik7XG4gICAgdGhyb3cgZXJyO1xuICB9XG4gIHJldHVybiBuZXcgVGV4dEVkaXRvcigvKmVkaXRvck9wdGlvbnMqLyB7YnVmZmVyLCByZWdpc3RlckVkaXRvcjogdHJ1ZX0pO1xufVxuXG4vKipcbiAqIEVuY3J5cHRzIHRoZSBjbGllbnRLZXkgb2YgYSBSZW1vdGVDb25uZWN0aW9uQ29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSByZW1vdGVQcm9qZWN0Q29uZmlnIC0gVGhlIGNvbmZpZyB3aXRoIHRoZSBjbGllbnRLZXkgd2Ugd2FudCBlbmNyeXB0ZWQuXG4gKiBAcmV0dXJuIHJldHVybnMgdGhlIHBhc3NlZCBpbiBjb25maWcgd2l0aCB0aGUgY2xpZW50S2V5IGVuY3J5cHRlZC5cbiAqL1xuZnVuY3Rpb24gcHJvdGVjdENsaWVudEtleShyZW1vdGVQcm9qZWN0Q29uZmlnOiBSZW1vdGVDb25uZWN0aW9uQ29uZmlndXJhdGlvbik6IFJlbW90ZUNvbm5lY3Rpb25Db25maWd1cmF0aW9uIHtcbiAgdmFyIHtyZXBsYWNlUGFzc3dvcmR9ID0gcmVxdWlyZSgnbnVjbGlkZS1rZXl0YXItd3JhcHBlcicpO1xuICB2YXIgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7XG5cbiAgdmFyIHNoYTEgPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMScpO1xuICBzaGExLnVwZGF0ZShgJHtyZW1vdGVQcm9qZWN0Q29uZmlnLmhvc3R9OiR7cmVtb3RlUHJvamVjdENvbmZpZy5wb3J0fWApO1xuICB2YXIgc2hhMXN1bSA9IHNoYTEuZGlnZXN0KCdoZXgnKTtcblxuICB2YXIge3NhbHQsIHBhc3N3b3JkLCBlbmNyeXB0ZWRTdHJpbmd9ID0gZW5jcnlwdFN0cmluZyhyZW1vdGVQcm9qZWN0Q29uZmlnLmNsaWVudEtleSk7XG4gIHJlcGxhY2VQYXNzd29yZCgnbnVjbGlkZS5yZW1vdGVQcm9qZWN0Q29uZmlnJywgc2hhMXN1bSwgYCR7cGFzc3dvcmR9YCk7XG5cbiAgcmVtb3RlUHJvamVjdENvbmZpZy5jbGllbnRLZXkgPSBlbmNyeXB0ZWRTdHJpbmcgKyAnLicgKyBzYWx0O1xuXG4gIHJldHVybiByZW1vdGVQcm9qZWN0Q29uZmlnO1xufVxuXG4vKipcbiAqIERlY3J5cHRzIHRoZSBjbGllbnRLZXkgb2YgYSBSZW1vdGVDb25uZWN0aW9uQ29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSByZW1vdGVQcm9qZWN0Q29uZmlnIC0gVGhlIGNvbmZpZyB3aXRoIHRoZSBjbGllbnRLZXkgd2Ugd2FudCBlbmNyeXB0ZWQuXG4gKiBAcmV0dXJuIHJldHVybnMgdGhlIHBhc3NlZCBpbiBjb25maWcgd2l0aCB0aGUgY2xpZW50S2V5IGVuY3J5cHRlZC5cbiAqL1xuZnVuY3Rpb24gcmVzdG9yZUNsaWVudEtleShyZW1vdGVQcm9qZWN0Q29uZmlnOiBSZW1vdGVDb25uZWN0aW9uQ29uZmlndXJhdGlvbik6IFJlbW90ZUNvbm5lY3Rpb25Db25maWd1cmF0aW9uIHtcbiAgdmFyIHtnZXRQYXNzd29yZH0gPSByZXF1aXJlKCdudWNsaWRlLWtleXRhci13cmFwcGVyJyk7XG4gIHZhciBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcblxuICB2YXIgc2hhMSA9IGNyeXB0by5jcmVhdGVIYXNoKCdzaGExJyk7XG4gIHNoYTEudXBkYXRlKGAke3JlbW90ZVByb2plY3RDb25maWcuaG9zdH06JHtyZW1vdGVQcm9qZWN0Q29uZmlnLnBvcnR9YCk7XG4gIHZhciBzaGExc3VtID0gc2hhMS5kaWdlc3QoJ2hleCcpO1xuXG4gIHZhciBwYXNzd29yZCA9IGdldFBhc3N3b3JkKCdudWNsaWRlLnJlbW90ZVByb2plY3RDb25maWcnLCBzaGExc3VtKTtcblxuICBpZiAoIXBhc3N3b3JkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZmluZCBwYXNzd29yZCBmb3IgZW5jcnlwdGVkIGNsaWVudCBrZXknKTtcbiAgfVxuXG4gIHZhciBzYWx0O1xuICB2YXIgY2xpZW50S2V5O1xuXG4gIFtjbGllbnRLZXksIHNhbHRdID0gcmVtb3RlUHJvamVjdENvbmZpZy5jbGllbnRLZXkuc3BsaXQoJy4nKTtcblxuICBpZiAoIWNsaWVudEtleSB8fCAhc2FsdCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGRlY3J5cHQgY2xpZW50IGtleScpO1xuICB9XG5cbiAgcmVtb3RlUHJvamVjdENvbmZpZy5jbGllbnRLZXkgPSBkZWNyeXB0U3RyaW5nKGNsaWVudEtleSwgcGFzc3dvcmQsIHNhbHQpO1xuXG4gIHJldHVybiByZW1vdGVQcm9qZWN0Q29uZmlnO1xufVxuXG5mdW5jdGlvbiBkZWNyeXB0U3RyaW5nKHRleHQ6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZywgc2FsdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgdmFyIGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xuXG4gIHZhciBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KFxuICAgICAgJ2Flcy0xMjgtY2JjJyxcbiAgICAgIG5ldyBCdWZmZXIocGFzc3dvcmQsICdiYXNlNjQnKSxcbiAgICAgIG5ldyBCdWZmZXIoc2FsdCwgJ2Jhc2U2NCcpKTtcblxuICB2YXIgZGVjcnlwdGVkU3RyaW5nID0gZGVjaXBoZXIudXBkYXRlKHRleHQsICdiYXNlNjQnLCAndXRmOCcpO1xuICBkZWNyeXB0ZWRTdHJpbmcgKz0gZGVjaXBoZXIuZmluYWwoJ3V0ZjgnKTtcblxuICByZXR1cm4gZGVjcnlwdGVkU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBlbmNyeXB0U3RyaW5nKHRleHQ6IHN0cmluZyk6IGFueSB7XG4gIHZhciBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbiAgdmFyIHBhc3N3b3JkID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KS50b1N0cmluZygnYmFzZTY0Jyk7XG4gIHZhciBzYWx0ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KS50b1N0cmluZygnYmFzZTY0Jyk7XG5cbiAgdmFyIGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdihcbiAgICAnYWVzLTEyOC1jYmMnLFxuICAgIG5ldyBCdWZmZXIocGFzc3dvcmQsICdiYXNlNjQnKSxcbiAgICBuZXcgQnVmZmVyKHNhbHQsICdiYXNlNjQnKSk7XG5cbiAgdmFyIGVuY3J5cHRlZFN0cmluZyA9IGNpcGhlci51cGRhdGUodGV4dCwgJ3V0ZjgnLCAnYmFzZTY0Jyk7XG4gIGVuY3J5cHRlZFN0cmluZyArPSBjaXBoZXIuZmluYWwoJ2Jhc2U2NCcpO1xuXG4gIHJldHVybiB7XG4gICAgcGFzc3dvcmQsXG4gICAgc2FsdCxcbiAgICBlbmNyeXB0ZWRTdHJpbmcsXG4gIH07XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBfX3Rlc3RfXzoge1xuICAgIGRlY3J5cHRTdHJpbmcsXG4gICAgZW5jcnlwdFN0cmluZyxcbiAgfSxcblxuICBhY3RpdmF0ZShzdGF0ZTogP2FueSk6IHZvaWQge1xuICAgIHN1YnNjcmlwdGlvbnMgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuXG4gICAgc3Vic2NyaXB0aW9ucy5hZGQoZ2V0UmVtb3RlQ29ubmVjdGlvbigpLm9uRGlkQWRkUmVtb3RlQ29ubmVjdGlvbihjb25uZWN0aW9uID0+IHtcbiAgICAgIGFkZFJlbW90ZUZvbGRlclRvUHJvamVjdChjb25uZWN0aW9uKTtcbiAgICB9KSk7XG5cbiAgICAvLyBEb24ndCBkbyByZXF1aXJlIG9yIGFueSBvdGhlciBleHBlbnNpdmUgb3BlcmF0aW9ucyBpbiBhY3RpdmF0ZSgpLlxuICAgIHN1YnNjcmlwdGlvbnMuYWRkKGF0b20ucGFja2FnZXMub25EaWRBY3RpdmF0ZUluaXRpYWxQYWNrYWdlcygoKSA9PiB7XG4gICAgICAvLyBTdWJzY3JpYmUgb3BlbmVyIGJlZm9yZSByZXN0b3JpbmcgdGhlIHJlbW90ZSBwcm9qZWN0cy5cbiAgICAgIHN1YnNjcmlwdGlvbnMuYWRkKGF0b20ud29ya3NwYWNlLmFkZE9wZW5lcigodXJpID0gJycpID0+IHtcbiAgICAgICAgaWYgKHVyaS5zdGFydHNXaXRoKCdudWNsaWRlOicpKSB7XG4gICAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBnZXRSZW1vdGVDb25uZWN0aW9uKCkuZ2V0Rm9yVXJpKHVyaSk7XG4gICAgICAgICAgLy8gT24gQXRvbSByZXN0YXJ0LCBpdCB0cmllcyB0byBvcGVuIHRoZSB1cmkgcGF0aCBhcyBhIGZpbGUgdGFiIGJlY2F1c2UgaXQncyBub3QgYSBsb2NhbCBkaXJlY3RvcnkuXG4gICAgICAgICAgLy8gV2UgY2FuJ3QgbGV0IHRoYXQgY3JlYXRlIGEgZmlsZSB3aXRoIHRoZSBpbml0aWFsIHdvcmtpbmcgZGlyZWN0b3J5IHBhdGguXG4gICAgICAgICAgaWYgKGNvbm5lY3Rpb24gJiYgdXJpICE9PSBjb25uZWN0aW9uLmdldFVyaUZvckluaXRpYWxXb3JraW5nRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgIGlmIChwZW5kaW5nRmlsZXNbdXJpXSkge1xuICAgICAgICAgICAgICByZXR1cm4gcGVuZGluZ0ZpbGVzW3VyaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdGV4dEVkaXRvclByb21pc2UgPSBwZW5kaW5nRmlsZXNbdXJpXSA9IGNyZWF0ZUVkaXRvckZvck51Y2xpZGUoY29ubmVjdGlvbiwgdXJpKTtcbiAgICAgICAgICAgIHZhciByZW1vdmVGcm9tQ2FjaGUgPSAoKSA9PiBkZWxldGUgcGVuZGluZ0ZpbGVzW3VyaV07XG4gICAgICAgICAgICB0ZXh0RWRpdG9yUHJvbWlzZS50aGVuKHJlbW92ZUZyb21DYWNoZSwgcmVtb3ZlRnJvbUNhY2hlKTtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0RWRpdG9yUHJvbWlzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICBzdWJzY3JpcHRpb25zLmFkZChhdG9tLmNvbW1hbmRzLmFkZChcbiAgICAgICAgJ2F0b20td29ya3NwYWNlJyxcbiAgICAgICAgJ251Y2xpZGUtcmVtb3RlLXByb2plY3RzOmNvbm5lY3QnLFxuICAgICAgICAoKSA9PiByZXF1aXJlKCdudWNsaWRlLXNzaC1kaWFsb2cnKS5vcGVuQ29ubmVjdGlvbkRpYWxvZygpXG4gICAgKSk7XG5cbiAgICAgIC8vIFJlbW92ZSByZW1vdGUgcHJvamVjdHMgYWRkZWQgaW4gY2FzZSBvZiByZWxvYWRzLlxuICAgICAgLy8gV2UgYWxyZWFkeSBoYXZlIHRoZWlyIGNvbm5lY3Rpb24gY29uZmlnIHN0b3JlZC5cbiAgICAgIHZhciByZW1vdGVQcm9qZWN0c0NvbmZpZyA9IChzdGF0ZSAmJiBzdGF0ZS5yZW1vdGVQcm9qZWN0c0NvbmZpZykgfHwgW107XG4gICAgICByZW1vdGVQcm9qZWN0c0NvbmZpZy5mb3JFYWNoKHJlc3RvcmVOdWNsaWRlUHJvamVjdFN0YXRlKTtcbiAgICAgIC8vIENsZWFyIG9ic29sZXRlIGNvbmZpZy5cbiAgICAgIGF0b20uY29uZmlnLnNldCgnbnVjbGlkZS5yZW1vdGVQcm9qZWN0c0NvbmZpZycsIFtdKTtcbiAgICB9KSk7XG4gIH0sXG5cbiAgc2VyaWFsaXplKCk6IGFueSB7XG4gICAgdmFyIHJlbW90ZVByb2plY3RzQ29uZmlnID0gZ2V0UmVtb3RlUm9vdERpcmVjdG9yaWVzKClcbiAgICAgICAgLm1hcChkaXJlY3RvcnkgPT4ge1xuICAgICAgICAgIHZhciBjb25uZWN0aW9uID0gZ2V0UmVtb3RlQ29ubmVjdGlvbigpLmdldEZvclVyaShkaXJlY3RvcnkuZ2V0UGF0aCgpKTtcbiAgICAgICAgICByZXR1cm4gY29ubmVjdGlvbiAmJiBwcm90ZWN0Q2xpZW50S2V5KGNvbm5lY3Rpb24uZ2V0Q29uZmlnKCkpO1xuICAgICAgICB9KS5maWx0ZXIoY29uZmlnID0+ICEhY29uZmlnKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVtb3RlUHJvamVjdHNDb25maWcsXG4gICAgfTtcbiAgfSxcblxuICBkZWFjdGl2YXRlKCk6IHZvaWQge1xuICAgIC8vIFRoaXMgc2hvdWxkIGFsd2F5cyBiZSB0cnVlIGhlcmUsIGJ1dCB3ZSBkbyB0aGlzIHRvIGFwcGVhc2UgRmxvdy5cbiAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgc3Vic2NyaXB0aW9ucy5kaXNwb3NlKCk7XG4gICAgICBzdWJzY3JpcHRpb25zID0gbnVsbDtcbiAgICB9XG4gIH0sXG5cbiAgY3JlYXRlUmVtb3RlRGlyZWN0b3J5UHJvdmlkZXIoKTogUmVtb3RlRGlyZWN0b3J5UHJvdmlkZXIge1xuICAgIHZhciBSZW1vdGVEaXJlY3RvcnlQcm92aWRlciA9IHJlcXVpcmUoJy4vUmVtb3RlRGlyZWN0b3J5UHJvdmlkZXInKTtcbiAgICByZXR1cm4gbmV3IFJlbW90ZURpcmVjdG9yeVByb3ZpZGVyKCk7XG4gIH0sXG5cbiAgY3JlYXRlUmVtb3RlRGlyZWN0b3J5U2VhcmNoZXIoKTogUmVtb3RlRGlyZWN0b3J5U2VhcmNoZXIge1xuICAgIHZhciB7Z2V0U2VydmljZUJ5TnVjbGlkZVVyaX0gPSByZXF1aXJlKCdudWNsaWRlLWNsaWVudCcpO1xuICAgIHZhciB7UmVtb3RlRGlyZWN0b3J5fSA9IHJlcXVpcmUoJ251Y2xpZGUtcmVtb3RlLWNvbm5lY3Rpb24nKTtcbiAgICB2YXIgUmVtb3RlRGlyZWN0b3J5U2VhcmNoZXIgPSByZXF1aXJlKCcuL1JlbW90ZURpcmVjdG9yeVNlYXJjaGVyJyk7XG4gICAgcmV0dXJuIG5ldyBSZW1vdGVEaXJlY3RvcnlTZWFyY2hlcigoZGlyOiBSZW1vdGVEaXJlY3RvcnkpID0+XG4gICAgICBnZXRTZXJ2aWNlQnlOdWNsaWRlVXJpKCdGaW5kSW5Qcm9qZWN0U2VydmljZScsIGRpci5nZXRQYXRoKCkpKTtcbiAgfSxcbn07XG4iXX0=
